{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "description": "Renovate configuration for Vixens GitOps - Auto-updates with approval workflow",
  "extends": [
    "config:base",
    ":dependencyDashboard"
  ],
  "dependencyDashboard": true,
  "dependencyDashboardTitle": "üì¶ Dependency Dashboard - Control Tower",
  "dependencyDashboardAutoclose": true,
  "dependencyDashboardLabels": ["dependencies", "renovate"],
  "baseBranches": ["main"],
  "gitAuthor": "Renovate Bot <renovate@vixens.local>",
  "platformAutomerge": true,
  "enabledManagers": ["terraform", "helm-values", "kubernetes", "regex", "dockerfile"],
  "kubernetes": {
    "fileMatch": ["apps/.+\\.yaml$", "argocd/.+\\.yaml$"]
  },
  "helm-values": {
    "fileMatch": ["(^|/)values.*\\.yaml$"]
  },
  "terraform": {
    "fileMatch": ["(^|/)\\.tf$"]
  },
  "packageRules": [
    {
      "description": "Group all minor and patch updates for non-critical dependencies",
      "matchUpdateTypes": ["minor", "patch"],
      "matchPackageNames": ["*"],
      "excludePackageNames": ["ghcr.io/home-assistant/home-assistant", "grafana/promtail", "grafana/loki"],
      "groupName": "minor and patch updates",
      "groupSlug": "minor-patch-all"
    },
    {
      "description": "LinuxServer.io images versioning",
      "matchPackagePatterns": ["^lscr\\.io/linuxserver/"],
      "versioning": "regex:^version-v?(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)(.*)?$"
    },
    {
      "description": "Lazylibrarian hex versioning",
      "matchPackageNames": ["lscr.io/linuxserver/lazylibrarian"],
      "versioning": "regex:^version-(?<major>[a-f0-9]+)$"
    },
    {
      "description": "Music Assistant beta versioning",
      "matchPackagePatterns": ["^ghcr\\.io/music-assistant/"],
      "versioning": "docker"
    },
    {
      "description": "AdGuard Home versioning",
      "matchPackagePatterns": ["^adguard/adguardhome"],
      "versioning": "docker"
    },
    {
      "description": "BirdNET-Go nightly versioning",
      "matchPackagePatterns": ["^ghcr\\.io/tphakala/birdnet-go"],
      "versioning": "regex:^nightly-(?<major>\\d+)$"
    },
    {
      "description": "Home Assistant Auto-Update",
      "matchPackageNames": ["ghcr.io/home-assistant/home-assistant"],
      "matchUpdateTypes": ["minor", "patch", "pin", "digest"],
      "automerge": true,
      "automergeType": "pr",
      "automergeStrategy": "squash",
      "labels": ["dependencies", "renovate", "automerge", "home-assistant"]
    },
    {
      "description": "Auto-merge minor and patch updates after approval",
      "matchUpdateTypes": ["minor", "patch", "pin", "digest"],
      "automerge": true,
      "automergeType": "pr",
      "automergeStrategy": "squash",
      "labels": ["dependencies", "renovate", "automerge"]
    },
    {
      "description": "Manual review required for major updates",
      "matchUpdateTypes": ["major"],
      "automerge": false,
      "labels": ["dependencies", "renovate", "major-update"]
    }
  ],
  "prConcurrentLimit": 10,
  "prHourlyLimit": 0,
  "branchConcurrentLimit": 20,
  "labels": ["dependencies", "renovate"],
  "assignees": ["@charchess"],
  "reviewers": ["@charchess"],
  "timezone": "Europe/Paris",
  "semanticCommits": "enabled",
  "commitMessagePrefix": "chore(deps):",
  "commitMessageAction": "update",
  "commitMessageTopic": "{{depName}}",
  "commitMessageExtra": "to {{#if isMajor}}{{prettyNewMajor}}{{else}}{{#if isSingleVersion}}{{prettyNewVersion}}{{else}}{{#if newValue}}{{{newValue}}}{{else}}{{{newDigestShort}}}{{/if}}{{/if}}{{/if}}",
  "prBodyTemplate": "{{{header}}}\n\n{{{table}}}\n\n{{{notes}}}\n\n{{{changelogs}}}\n\n---\n\n### üöÄ Deployment Strategy\n\n{{#if isMajor}}‚ö†Ô∏è **Major update** - Manual review required{{else}}‚úÖ **Auto-merge enabled** - Will merge automatically after approval{{/if}}\n\n- [ ] Reviewed changes\n- [ ] Ready to deploy to main branch (dev cluster)\n- [ ] Notify on Discord: `@everyone New dependency update ready for approval`\n\n---\n\n{{{footer}}}"
}