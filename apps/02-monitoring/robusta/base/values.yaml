clusterName: "vixens-prod"

globalConfig:
  account_id: "vixens-prod"
  signing_key: "$ROBUSTA_SIGNING_KEY"
  prometheus_url: "http://prometheus-server.monitoring.svc.cluster.local"

sinksConfig:
  - slack_sink:
      name: discord_via_slack_sink
      url: "${DISCORD_WEBHOOK_URL}/slack"

runner:
  envFrom:
    - secretRef:
        name: robusta-secrets
  # UTILISATION DU PARAMÃˆTRE NATIF DU CHART
  additional_init_containers:
    - name: config-interpolator
      image: alpine:3.18
      command: ["sh", "-c"]
      args:
        - |
          apk add --no-cache gettext
          echo "Interpolating Robusta config..."
          envsubst < /config-template/active_playbooks.yaml.tmpl > /config-final/active_playbooks.yaml
          echo "Done."
      envFrom:
        - secretRef:
            name: robusta-secrets
      volumeMounts:
        - name: config-template
          mountPath: /config-template
        - name: config-final
          mountPath: /config-final
  
  # Montage des volumes
  additional_volumes:
    - name: config-template
      configMap:
        name: robusta-config-template
    - name: config-final
      emptyDir: {}
  
  # Montage du fichier final dans le runner
  additional_volume_mounts:
    - name: config-final
      mountPath: /etc/robusta/config/active_playbooks.yaml
      subPath: active_playbooks.yaml
