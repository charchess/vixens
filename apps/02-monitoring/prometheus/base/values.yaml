---
# Prometheus standalone configuration

# Server configuration
server:
  priorityClassName: vixens-critical
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule
  persistentVolume:
    enabled: true
    storageClass: synelia-iscsi-retain
    size: 50Gi
  retention: 30d
  resources:
    requests:
      cpu: 1000m
      memory: 2Gi
    limits:
      cpu: 1000m
      memory: 2Gi

# Extra scrape configurations
extraScrapeConfigs: ""

# Alertmanager configuration
alertmanager:
  enabled: true
  priorityClassName: vixens-critical
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule
  persistentVolume:
    enabled: true
    storageClass: synelia-iscsi-retain
    size: 10Gi
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 200m
      memory: 512Mi
  extraVolumes:
    - name: alertmanager-secrets
      secret:
        secretName: alertmanager-secrets
  extraVolumeMounts:
    - name: alertmanager-secrets
      mountPath: /etc/alertmanager-secrets
      readOnly: true
  extraEnv:
    - name: DISCORD_WEBHOOK_URL
      valueFrom:
        secretKeyRef:
          name: alertmanager-secrets
          key: DISCORD_WEBHOOK_URL
          optional: true
  config:
    global:
      resolve_timeout: 5m
    route:
      group_by:
        - alertname
        - cluster
        - service
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 12h
      receiver: discord-notifications
      routes:
        - match:
            severity: critical
          receiver: discord-notifications
    receivers:
      - name: discord-notifications
        slack_configs:
          - api_url_file: /etc/alertmanager-secrets/DISCORD_WEBHOOK_URL
            channel: '#alerts'
            send_resolved: true
# Node exporter
nodeExporter:
  enabled: true
  priorityClassName: vixens-critical
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule
  hostNetwork: true
  hostPID: true
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 200m
      memory: 256Mi
# Pushgateway subchart (disabled - réactiver si CronJobs/batch jobs nécessaires)
prometheus-pushgateway:
  enabled: false
# Kube-state-metrics subchart (metrics on Kubernetes objects)
kube-state-metrics:
  enabled: true
  priorityClassName: vixens-critical
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 200m
      memory: 256Mi
