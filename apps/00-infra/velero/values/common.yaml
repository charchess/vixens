# Velero - SOTA 2026 Common Configuration
image:
  repository: velero/velero
  tag: v1.17.2
  pullPolicy: IfNotPresent

configuration:
  uploaderType: kopia
  # THIS IS THE KEY: Using ConfigMap disables the legacy flag injection
  repoMaintenanceJobConfigMap: velero-repo-maintenance-config
  # Explicitly set to null to avoid default injection by chart
  keepLatestMaintenanceJobs: 0

initContainers:
  - name: velero-plugin-for-aws
    image: velero/velero-plugin-for-aws:v1.13.2
    imagePullPolicy: IfNotPresent
    volumeMounts:
      - mountPath: /target
        name: plugins

resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

nodeAgent:
  enabled: true
  uploaderType: kopia
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule

metrics:
  enabled: true

tolerations:
  - key: node-role.kubernetes.io/control-plane
    operator: Exists
    effect: NoSchedule

upgradeCRDs: false
cleanUpCRDs: false
