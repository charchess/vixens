apiVersion: secrets.infisical.com/v1alpha1
kind: InfisicalSecret
metadata:
  name: mosquitto-password-sync
  namespace: mosquitto
spec:
  authentication:
    universalAuth:
      credentialsRef:
        secretName: infisical-universal-auth
        secretNamespace: argocd
      secretsScope:
        projectSlug: vixens
        envSlug: dev # Targeting the dev environment
        secretsPath: /mosquitto
  hostAPI: http://192.168.111.69:8085 # Assuming dev uses the same Infisical server endpoint
  managedSecretReference:
    secretName: mosquitto-password-file
    secretNamespace: mosquitto
    creationPolicy: Owner
    secretType: Opaque
  data:
    - secretPath: MOSQUITTO_PASSWD_FILE
      name: mosquitto.passwd
  resyncInterval: 60
