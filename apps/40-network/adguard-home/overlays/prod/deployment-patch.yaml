---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: adguard-home
spec:
  template:
    spec:
      volumes:
        - name: config-patcher
          configMap:
            name: adguard-home-config-patcher
      initContainers:
        - name: configure-adguard
          image: python:3.12-slim
          command: ["python3", "/scripts/patcher.py"]
          env:
            - name: ADGUARD__ADMIN_USER
              valueFrom:
                secretKeyRef:
                  name: adguard-home-secrets
                  key: ADMIN_USER
            - name: ADGUARD__ADMIN_PASS
              valueFrom:
                secretKeyRef:
                  name: adguard-home-secrets
                  key: ADMIN_PASS
          volumeMounts:
            - name: adguard-conf
              mountPath: /opt/adguardhome/conf
            - name: config-patcher
              mountPath: /scripts
