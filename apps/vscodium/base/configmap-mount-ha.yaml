---
apiVersion: v1
kind: ConfigMap
metadata:
  name: vscodium-mount-ha-script
  namespace: vscodium
data:
  mount-homeassistant.sh: |
    #!/bin/bash
    set -e

    echo "ğŸ”§ Installing davfs2..."
    sudo apt-get update -qq
    sudo apt-get install -y -qq davfs2

    echo "ğŸ“ Creating mount point..."
    mkdir -p /home/coder/homeassistant

    echo "ğŸ” Setting up credentials..."
    cat > /tmp/davfs2.secrets <<EOF
    admin DeqxOodrO6etyd97JmkoJo88lbgVvO
    EOF
    chmod 600 /tmp/davfs2.secrets

    echo "ğŸ—‚ï¸  Mounting WebDAV..."
    sudo mount.davfs -o uid=1000,gid=1000,file_mode=644,dir_mode=755 \
      http://homeassistant-svc.homeassistant.svc.cluster.local:8080 \
      /home/coder/homeassistant \
      < /tmp/davfs2.secrets

    rm /tmp/davfs2.secrets

    echo "âœ… Home Assistant configs mounted at /home/coder/homeassistant"
    echo "   Open this folder in VSCodium: File â†’ Open Folder â†’ /home/coder/homeassistant"
