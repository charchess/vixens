---
apiVersion: v1
kind: Service
metadata:
  name: frigate-lb
  labels:
    app: frigate
  annotations:
    # Partage le même pool d'IPs que Traefik (Cilium L2 Announcements)
    io.cilium/lb-ipam-ips: "192.168.201.72"
spec:
  type: LoadBalancer
  allocateLoadBalancerNodePorts: true
  selector:
    app: frigate
  ports:
    # API HTTP pour Home Assistant
    - name: http-api
      port: 5000
      targetPort: 5000
      protocol: TCP
    # RTSP pour streaming caméras
    - name: rtsp
      port: 8554
      targetPort: 8554
      protocol: TCP
    # WebRTC pour streaming temps réel
    - name: webrtc
      port: 8555
      targetPort: 8555
      protocol: TCP
    # RTMP (optionnel, peut être utilisé par certains clients)
    - name: rtmp
      port: 1935
      targetPort: 1935
      protocol: TCP
