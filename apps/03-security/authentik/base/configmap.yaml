---
apiVersion: v1
kind: ConfigMap
metadata:
  name: authentik-config
  namespace: auth
data:
  netbird.yaml: |
    version: 1
    metadata:
      name: netbird-oidc
    entries:
      - model: authentik_providers_oauth2.oauth2provider
        id: netbird-provider
        attrs:
          name: netbird
          client_id: netbird
          client_type: public
          authorization_flow: !Find [authentik_flows.flow, [slug, default-provider-authorization-implicit-consent]]
          redirect_uris:
            - https://netbird.dev.truxonline.com/
            - https://netbird.dev.truxonline.com/silent-auth
            - https://netbird.truxonline.com/
            - https://netbird.truxonline.com/silent-auth
          property_mappings:
            - !Find [authentik_core.propertymapping, [managed, goauthentik.io/providers/oauth2/scope-openid]]
            - !Find [authentik_core.propertymapping, [managed, goauthentik.io/providers/oauth2/scope-profile]]
            - !Find [authentik_core.propertymapping, [managed, goauthentik.io/providers/oauth2/scope-email]]
            - !Find [authentik_core.propertymapping, [managed, goauthentik.io/providers/oauth2/scope-offline_access]]
      - model: authentik_core.application
        id: netbird-app
        attrs:
          name: Netbird
          slug: netbird
          provider: !KeyOf netbird-provider
