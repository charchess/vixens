apiVersion: v1
kind: ConfigMap
metadata:
  name: netbox-config
  namespace: tools
data:
  configuration.py: |
    import os
    import dj_database_url

    # Load database configuration from DATABASE_URL
    DATABASE_URL = os.getenv('DATABASE_URL')
    if DATABASE_URL:
        DATABASES = {
            'default': dj_database_url.config(default=DATABASE_URL, conn_max_age=600)
        }
    else:
        # Fallback if needed (though we expect DATABASE_URL)
        DATABASES = {
            'default': {
                'ENGINE': 'django.db.backends.postgresql',
                'NAME': os.getenv('DB_NAME', 'netbox'),
                'USER': os.getenv('DB_USER', 'netbox'),
                'PASSWORD': os.getenv('DB_PASSWORD', 'netbox'),
                'HOST': os.getenv('DB_HOST', 'localhost'),
                'PORT': os.getenv('DB_PORT', '5432'),
            }
        }

    # Redis settings
    REDIS = {
        'tasks': {
            'HOST': os.getenv('REDIS_HOST', 'redis-shared'),
            'PORT': int(os.getenv('REDIS_PORT', 6379)),
            'PASSWORD': os.getenv('REDIS_PASSWORD', ''),
            'DATABASE': 0,
            'SSL': False,
        },
        'caching': {
            'HOST': os.getenv('REDIS_HOST', 'redis-shared'),
            'PORT': int(os.getenv('REDIS_PORT', 6379)),
            'PASSWORD': os.getenv('REDIS_PASSWORD', ''),
            'DATABASE': 1,
            'SSL': False,
        }
    }

    # SECRET_KEY
    SECRET_KEY = os.getenv('SECRET_KEY')

    # ALLOWED_HOSTS
    ALLOWED_HOSTS = os.getenv('ALLOWED_HOSTS', 'localhost').split(',')

    # PLUGINS
    PLUGINS = []
    PLUGINS_CONFIG = {}