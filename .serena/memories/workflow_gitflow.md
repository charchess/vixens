# Workflow & GitFlow

## Working Principles
*   Focus on one `OBJECTIF` at a time.
*   `OBJECTIF` defined in `/docs/objectives/`.
*   Continuous Validation: Re-validate all "done" tasks for an objective after any modification.

## GitFlow
*   **Branches:** `main` (prod), `staging`, `test`, `dev`, `feature/*`, `fix/*`, `docs/*` (based on `dev`).
*   **Promotion Path:** `feature/*` -> `dev` -> `test` -> `staging` -> `main` (via PRs).

## Pre-PR Quality
*   **Linting YAML:** `find apps argocd -name "*.yaml" -o -name "*.yml" | xargs yamllint -c .yamllint`
*   **Tests:** Unit and integration tests must pass.
*   **Linting & Type-Checking:** Language-specific, no errors.

## Commits & Pull Requests
*   **Title Format:** `v<M.m.p>: <type>(<scope>) - "Humorous Title"` (e.g., `v1.1.1: feat(talos) - "Et la lumi√®re fut !"`)
*   **PR Content:** `Relates to OBJECTIF-XX`, Description, Test Procedure, Results & Log, Non-Regression Validation.

## Terraform Specifics
*   **Validation:** `terraform plan` output in PR before `terraform apply`.
*   **State Management:** S3 backend, DynamoDB locking.

## ArgoCD Specifics
*   **Applications:** Each K8s app managed by an ArgoCD `Application`.
*   **Definition:** `argocd/base/app-templates/` and Kustomize in `argocd/overlays/<env>/`.
*   **Synchronization:** `auto-sync` with `Prune=true` and `SelfHeal=true`.

## Talos Specifics
*   **Configuration:** Generated by Terraform.
*   **Secrets:** Managed via `sops`.

## Secrets Management
*   Encrypted with `sops`, stored in Git.
*   KMS for encryption keys.
*   Temporary cleartext secrets for `dev` might be tolerated for debugging, but must be documented and a task created to resolve before `staging`.
