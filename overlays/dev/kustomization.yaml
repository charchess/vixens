# overlays/dev/kustomization.yaml
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base/argocd

patchesStrategicMerge:
  - argocd-config-patch.yaml

patches:
  # Patch du Deployment pour d√©sactiver l'authentification
  - target:
      kind: Deployment
      name: argocd-server
    patch: |-
      - op: add
        path: /spec/template/spec/containers/0/args/-
        value: --insecure
      - op: add
        path: /spec/template/spec/containers/0/args/-
        value: --disable-auth
  
  # Patch du Service pour enlever HTTPS et garder uniquement HTTP
  - target:
      kind: Service
      name: argocd-server
    patch: |-
      - op: replace
        path: /spec/ports
        value:
          - name: http
            port: 80
            protocol: TCP
            targetPort: 8080
          - name: https
            port: 443
            protocol: TCP
            targetPort: 8080
