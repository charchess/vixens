# clusters/vixens/argocd/apps/metallb-appset.yaml
---
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: metallb
  namespace: argocd
spec:
  generators:
  - list:
      elements:
      - name: dev
        cluster: vixens-dev
        path: overlays/dev/metallb
      - name: prod
        cluster: vixens
        path: overlays/prod/metallb
  template:
    metadata:
      # ðŸ‘‡ MÃªme nom partout
      name: metallb
    spec:
      project: vixens
      source:
        repoURL: https://github.com/charchess/vixens.git
        targetRevision: HEAD
        path: '{{path}}'
      destination:
        name: '{{cluster}}'   # Doit correspondre aux clusters ajoutÃ©s avec `argocd cluster add`
        namespace: metallb-system
      syncPolicy:
        automated:
          prune: true
          selfHeal: true
        syncOptions:
          - CreateNamespace=true
