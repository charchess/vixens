---
# Generic template for Helm-sourced applications
# Used for apps like: traefik, cert-manager, cert-manager-webhook-gandi, synology-csi
#
# This template uses inline Helm values (to be externalized in Phase 2).
# For Phase 2, we'll add support for ArgoCD's multiple sources feature to
# pull values from Git repository.
#
# Placeholders:
# - APP_NAME: Application name
# - HELM_REPO: Helm chart repository URL
# - CHART_NAME: Name of the chart
# - CHART_VERSION: Chart version (e.g., v25.0.0)
# - NAMESPACE: Target namespace
# - HELM_VALUES: Inline Helm values (will be externalized in Phase 2)

apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: APP_NAME
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "0"
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  source:
    repoURL: HELM_REPO
    chart: CHART_NAME
    targetRevision: CHART_VERSION
    helm:
      values: |
        HELM_VALUES
  destination:
    server: https://kubernetes.default.svc
    namespace: NAMESPACE
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true # Recommended for Helm charts
  # Retry configuration for transient failures
  retry:
    limit: 5
    backoff:
      duration: 5s
      factor: 2
      maxDuration: 3m
