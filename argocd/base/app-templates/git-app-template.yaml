---
# Generic template for Git-sourced Kustomize applications
# Used for apps like: whoami, argocd, cilium-lb, cert-manager-config, etc.
#
# This template will be customized per environment using Kustomize patches
# and replacements to inject environment-specific values.
#
# Placeholders:
# - APP_NAME: Will be set via patch metadata.name
# - TARGET_REVISION: Will be replaced with environment (dev/test/staging/main
# for prod)
# - APP_PATH: Will be replaced with environment-specific path
# - NAMESPACE: Will be set via patch

apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: APP_NAME
  namespace: argocd
  annotations:
    argocd.argoproj.io/manifest-generate-paths: .
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  source:
    repoURL: https://github.com/charchess/vixens.git
    targetRevision: TARGET_REVISION
    path: APP_PATH
  destination:
    server: https://kubernetes.default.svc
    namespace: NAMESPACE
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
  # Retry configuration for transient failures
  retry:
    limit: 3
    backoff:
      duration: 5s
      factor: 2
      maxDuration: 3m
